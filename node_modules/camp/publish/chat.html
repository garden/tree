<!doctype html>
<meta charset=utf-8>
<title>Chat</title>

<section id=log></section>

<input id=nick type=text value=Anonymous>

<form id=sofa autocomplete=off>
  <div id=prompt><input id=in type=text placeholder="Start Chatting!" autofocus></div>
</form>

<style>
  #log { position:fixed; top:0px; bottom:2em; right:0px;
    width:100%; overflow-x:auto; }
  #log p { margin-left: 5px; text-indent:5px; }
  #sofa { position:fixed; bottom:0px; left:0px; width:100%; }
  #prompt { padding:0px 3px; }
  #in, #nick { border:0px; outline:0px; }
  #in { width: 100%; padding:0px 0px; font-size:1.5em; }
  #nick { position:fixed; top:5px; right:5px; text-align: right; }
</style>

<script src=/js/scout.js>/* Ajax library. */</script>
<script>
(function(){

  var box = Scout('#in'), wall = Scout('#log'), nick = Scout('#nick');

  function log(nick, message) {
    var p = document.createElement('p');
    wall.appendChild(p).textContent = nick + ': ' + message;
    box.focus();
    p.scrollIntoView();
  }

  Scout('#sofa').on('submit', function (query) {
    query.action = 'talk';
    query.data = {nick: nick.value, message: box.value};
    box.value = '';
  });


  // Main function.
  window.onload = function loading () {

    (function listen () {
      Scout.maker().send (function (query) {
        query.action = 'all';
        query.data = {a:0};
        query.resp = function (data) {
          if (data.message) log(data.nick, data.message);
          listen();
        };
        query.error = function () { listen(); };
      })();
    }());
  };

}());
</script>

